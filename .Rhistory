end_date = "2017-06-20")
pitches3 <- scrape_statcast_savant_batter_all(start_date = "2017-06-21",
end_date = "2017-06-30")
pitches = rbind(pitches1,pitches2,pitches3)
pitches %>% filter(type != "X") -> taken
path = "https://raw.githubusercontent.com/beanumber/baseball_R/master/data/"
file = "masterid.csv"
master_id <- read_csv(paste(path,file, sep = ""))
taken %>%
left_join(select(master_id,mlb_id,mlb_name),
by = c("pitcher" = "mlb_id")) %>%
rename(pitcher_name = mlb_name) -> taken
taken%>%
group_by(pitcher_name)%>%
add_tally()%>%
filter(n>400)-> taken
strike_mod <- gam(type=="S" ~ s(plate_x,plate_z),
family = binomial, data = taken)
taken%>%
group_by() %>%
mutate(strike_prob= predict(strike_mod, newdata= ., type = "response")) -> taken
mod_a <- glmer(type != "X" ~ strike_prob + (1|pitcher_name),data = taken,family = binomial)
mod_a <- glmer(type == "S" ~ strike_prob + (1|pitcher_name),data = taken,family = binomial)
summary(mod_a)
3000/74
x = seq(-5,5,0.1)
plot(x, 5 + 4*x - 5*x^2 )
plot(x, 5 + 4*x - 0.55*x^2 )
plot(x, 5 + 0.5*x - 0.55*x^2 )
plot(x, 2 + 0.5*x - 0.55*x^2 )
library(Lahman)
library(tidyverse)
#find Arod :( player ID
Master %>%
filter(nameLast == "Rodriguez", nameFirst == "Alex") %>%
pull(playerID) -> arod.id
Batting %>%
filter(playerID == arod.id)
#this function is in Chapter8_functions.R
source("Chapter8_functions.R")
get_stats(arod.id) -> ARod
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
labs("ARod OPS")
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
labs("ARod OPS")
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
labs("ARod OPS") +
geom_smooth(method = "lm",
formula = x + I(x^2),
se = FALSE)
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
labs("ARod OPS") +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE)
fit_model(Arod)
fit_model(ARod)
fit_model(ARod) %>% pluck(fit)
fit_model(ARod) %>% pluck("fit")
Master %>%
filter(nameLast == "Ortiz", nameFirst == "David") %>%
pull(playerID)
player.ids <- c(arod.id, "ortizda01")
player.ids %>%
split(.) %>%
map(get_stats) -> player.stats
player.ids %>%
map_df(get_stats) -> player.stats
library(Lahman)
library(tidyverse)
#find Arod :( player ID
Master %>%
filter(nameLast == "Rodriguez", nameFirst == "Alex") %>%
pull(playerID) -> arod.id
#get_stats (pg 180)
#this function is in Chapter8_functions.R
source("Chapter8_functions.R")
get_stats(arod.id) -> ARod
player.ids <- c(arod.id, "ortizda01")
player.ids %>%
map_df(get_stats) -> player.stats
player.stats
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
facet_wrap(~ playerID)
facet_wrap(~ playerID)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2)) +
facet_wrap(~ playerID)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap(~ playerID)
player.ids %>%
map_df(get_stats) %>%
left_join(Master %>% select(nameLast, playerID))-> player.stats
player.stats
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap(~ nameLast)
Master %>% filter(nameLast == "Jeter")
Master %>% filter(nameLast == "Pujols")
player.ids <- c(arod.id, "ortizda01", "jeterde01", "pujolal01")
player.ids %>%
map_df(get_stats) %>%
left_join(Master %>% select(nameLast, playerID))-> player.stats
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap(~ nameLast)
player.ids %>%
map_df(fit_model)
player.stats %>%
split(.$playerID) %>%
map_df(fit_model)
player.stats %>%
split(pull(.,playerID)) %>%
map_df(fit_model)
player.stats %>%
split(pull(.,playerID)) %>%
map(fit_model)
arod.id
get_stats("pujola01") -> Pujols
get_stats("pujolal01") -> Pujols
Pujols %>% filter(Age < 30) -> Pujols.young
fit_model(Pujols.young_
fit_model(Pujols.young)
fit_model(Pujols.young)
Ortiz %>% filter(Age < 30) -> Ortiz.young
fit_model(Pujols.young)
fit_model(Ortiz.young)
Ortiz %>% filter(Age < 30) -> Ortiz.young
fit_model(Ortiz.young)
get_stats("ortizda01") -> Ortiz
Ortiz %>% filter(Age < 30) -> Ortiz.young
fit_model(Ortiz.young)
Ortiz %>%
mutate(OPS_predict = 1.23 + 0.15 * Age + 0.01059 * Age^2) -> Ortiz
Ortiz %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line()
Ortiz %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(x = Age, y = OPS))
Ortiz %>%
mutate(OPS_predict = 1.23 + 0.15327 * Age + 0.01059 * Age^2) -> Ortiz
Ortiz %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(x = Age, y = OPS))
fit_model(Ortiz.young)
Ortiz %>%
mutate(OPS_predict = 1.23 + 0.15327 * (Age -30) + 0.01059 * (Age-30)^2) -> Ortiz
Ortiz %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(x = Age, y = OPS))
dev.off()
library(Lahman)
library(tidyverse)
#find Arod :( player ID
Master %>%
filter(nameLast == "Rodriguez", nameFirst == "Alex") %>%
pull(playerID) -> arod.id
#this function is in Chapter8_functions.R
source("Chapter8_functions.R")
get_stats(arod.id) -> ARod
ARod %>% head(5)
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point()
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() + labs("ARod")
ARod %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() + labs("ARod") +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE)
fit_model(ARod)
# Other playerIDs we might be interested in.
player.ids <- c("rodrial01", "ortizda01", "jeterde01", "pujolal01")
library(Lahman)
library(tidyverse)
#find Arod :( player ID
Master %>%
filter(nameLast == "Rodriguez", nameFirst == "Alex") %>%
pull(playerID) -> arod.id
# Other playerIDs we might be interested in.
player.ids <- c("rodrial01", "ortizda01", "jeterde01", "pujolal01")
player.ids
player.ids %>%
map_df(get_stats) -> player.stats
player.stats %>% head(5)
player.stats %>% tail(5)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ playerID)
left_join(Master %>% select(nameLast, playerID) -> player.stats
)
player.ids %>%
map_df(get_stats) %>%
left_join(Master %>% select(nameLast, playerID)) -> player.stats
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
split(pull(.,nameLast)) %>%
map_df(fit_model)
player.stats %>%
split(pull(.,nameLast)) %>%
map(fit_model)
get_stats("ortizda01") -> Ortiz
Ortiz %>% head(5)
Ortiz %>% head(10)
Ortiz %>% filter(Age < 30) -> Ortiz.young
fit_model(Ortiz.young)
Ortiz %>%
mutate(OPS_predict = 1.2323 + 0.1532*(Age-30) + 0.01059*(Age-30)^2) -> Ortiz
Ortiz %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(x = Age, y = OPS))
dev.off()
library(tidyverse)
library(Lahman)
#find Big Papi's playerID
Master %>%
filter(nameLast == "Ortiz", nameFirst == "David") %>%
pull(playerID)-> ortiz.id
# Other playerIDs we might be interested in.
player.ids <- c("rodrial01", "ortizda01", "jeterde01", "pujolal01")
#get Ortiz's stats by age using get_stats
source("Chapter8_functions.R")
Ortiz.stats <- get_stats(ortiz.id)
Ortiz.stats %>% head(5)
Ortiz.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() + labs(title = "Ortiz")
Ortiz.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() + labs(title = "Ortiz") +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE)
fit_model(Ortiz.stat)
fit_model(Ortiz.stats)
player.ids
get_stats(player.id)
get_stats(player.ids)
player.ids %>%
map(get_stats) -> player.stats
player.stats %>% head(5)
player.ids %>%
map_df(get_stats) -> player.stats
player.stats %>% head(5)
player.stats %>% tail(5)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2)) +
facet_wrap( ~ playerID)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ playerID)
player.ids %>%
map_df(get_stats) %>%
left_join(Master %>% select(nameLast, playerID)) -> player.stats
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(
se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
ggplot(aes(x = Age, y = OPS)) +
geom_point() +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
facet_wrap( ~ nameLast)
player.stats %>%
map(fit_model)
player.stats %>%
split(pull(.,playerID)) %>%
map(fit_model)
# Breaking these models is pretty easy (see Ortiz)
Ortiz.stats
# Breaking these models is pretty easy (see Ortiz)
Ortiz.stats %>% filter(Age < 30) -> Ortiz.young
Ortiz.young
fit_model(Ortiz.young)
Ortiz.stats %>%
mutate(OPS_predict = 1.23 + 0.15 * (Age - 30) + 0.0159(Age - 30^2)) -> Ortiz.stats
Ortiz.stats %>%
mutate(OPS_predict = 1.23 + 0.15 * (Age - 30) + 0.0159*(Age - 30^2)) -> Ortiz.stats
Ortiz.stats %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(Age,OPS))
Ortiz.stats %>%
mutate(OPS_predict = 1.23 + 0.15 * (Age - 30) + 0.0159*(Age - 30)^2) -> Ortiz.stats
Ortiz.stats %>%
ggplot(aes(x = Age, y = OPS_predict)) +
geom_line() +
geom_point(aes(Age,OPS))
players
players.ids
library(tidyverse)
library(Lahman)
#find Big Papi's playerID
Master %>%
filter(nameLast == "Ortiz", nameFirst == "David") %>%
pull(playerID)-> ortiz.id
# Other playerIDs we might be interested in.
player.ids <- c("rodrial01", "ortizda01", "jeterde01", "pujolal01")
#get Ortiz's stats by age using get_stats
source("Chapter8_functions.R")
player.ids
player.ids %>%
map(get_stats) -> player.stats
player.stats
player.ids %>%
map_df(get_stats) -> player.stats
player.stats
player.stats %>%
ggplot(aes(Age, OPS)) +
geom_point() +
facet_wrap( ~ playerID)
player.stats %>%
split(pull(.,playerID)) %>%
map(fit_model)
Master
library(lubridate)
Master %>%
mutate(debut_year = year(debut))
Master %>%
mutate(debut_year = year(debut)) %>%
select(playerID, debut_year)
library(Lahman)
library(tidyverse)
#Players with debut in year 2000
Master %>%
filter(year(debut) == 2000)
library(lubridate)
#Players with debut in year 2000
Master %>%
filter(year(debut) == 2000)
#Players with debut in year 2000
Master %>%
filter(year(debut) == 2000) %>%
pull(playerID) -> year2000.ids
Batting %>%
group_by(playerID) %>%
summarize(AB = sum(AB)) %>%
filter(AB > 1000) %>%
pull(playerID) -> AB1000.ids
Batting %>%
filter(playerID %in% year2000.ids,
playerID %in% AB1000.ids)
Batting %>%
filter(playerID %in% year2000.ids,
playerID %in% AB1000.ids) %>%
left_join(Master %>% select(nameLast, nameFirst)) -> player.stats
Batting %>%
filter(playerID %in% year2000.ids,
playerID %in% AB1000.ids) %>%
left_join(Master %>% select(nameLast, nameFirst, playerID)) -> player.stats
source("Chapter8_functions.R")
player.ids <- interect(year2000.ids, AB1000.ids)
player.ids <- intersect(year2000.ids, AB1000.ids)
#Players with at least 1000 atbats
Batting %>%
filter(playerID %in% year2000.ids) %>%
group_by(playerID) %>%
summarize(AB = sum(AB)) %>%
filter(AB > 1000) %>%
pull(playerID) -> player.ids
library(Lahman)
library(tidyverse)
library(lubridate)
#Players with debut in year 2000
Master %>%
filter(year(debut) == 2000) %>%
pull(playerID) -> year2000.ids
#Players with at least 1000 atbats
Batting %>%
filter(playerID %in% year2000.ids) %>%
group_by(playerID) %>%
summarize(AB = sum(AB)) %>%
filter(AB > 1000) %>%
pull(playerID) -> player.ids
source("Chapter8_functions.R")
# get statistics by age
player.ids %>%
map(get_stats)
# get statistics by age
player.ids %>%
map_df(get_stats)
# get statistics by age
player.ids %>%
map_df(get_stats) -> player.stats
# get statistics by age and add names
player.ids %>%
map_df(get_stats) %>%
left_join(Master %>% select(nameLast, nameFirst, playerID))-> player.stats
player.stats
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method == "lm",
formula = x + I(x^2))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method == "lm",
formula = y~ x + I(x^2))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE)
library(ggrepel)
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
geom_text_repel(aes(group = playerID))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
geom_text_repel(aes(label = playerID))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE) +
geom_text_repel(aes(label = playerID, group = playerID))
#plot trajectories
player.stats %>%
ggplot(aes(x = Age, y = OBP, group = playerID)) +
geom_smooth(method = "lm",
formula = y ~ x + I(x^2),
se = FALSE)
